<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadow Queen</title>
    <style>
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #0f0f0f, #1a1a2e, #16213e);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            color: white;
            font-family: 'Arial', sans-serif;
        }

        .game-title {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #d4af37, #ffd700, #b8941f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 10px #d4af37); }
            to { filter: drop-shadow(0 0 20px #ffd700); }
        }

        .game-subtitle {
            font-size: 1.2rem;
            margin-bottom: 40px;
            color: #ccc;
            text-align: center;
        }

        .menu-options {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 40px;
        }

        .menu-button {
            padding: 15px 30px;
            font-size: 1.1rem;
            background: linear-gradient(45deg, #d4af37, #ffd700);
            color: #000;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 250px;
        }

        .menu-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
        }

        .game-rules-preview {
            max-width: 400px;
            text-align: center;
            color: #bbb;
            line-height: 1.6;
        }

        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            font-family: 'Arial', sans-serif;
            font-size: 16px;
            color: white;
            overflow: hidden;
        }

        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .table {
            width: 80vmin;
            height: 80vmin;
            border-radius: 50%;
            background: radial-gradient(ellipse at center, #0f4c75 0%, #1e3c72 70%);
            border: 8px solid #d4af37;
            position: relative;
            box-shadow: 0 0 50px rgba(212, 175, 55, 0.3);
        }

        .center-info {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #d4af37;
            min-width: 200px;
        }

        .leading-suit {
            margin-top: 10px;
            padding: 8px 12px;
            background: white;
            border: 1px solid #333;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .trump-info {
            margin-top: 10px;
            font-size: 16px;
        }

        .partner-info {
            margin-top: 5px;
            font-size: 14px;
            color: #ffd700;
        }

        .player {
            position: absolute;
            width: 120px;
            height: 80px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #d4af37;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transform-origin: center;
            transition: all 0.3s ease;
        }

        .player.active {
            background: rgba(0, 100, 0, 0.8);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        }

        .player.main-team {
            border-color: #ff6b6b;
        }

        .player.village-team {
            border-color: #4ecdc4;
        }

        .player-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .player-bid {
            font-size: 14px;
            color: #ffd700;
        }

        .cards-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 5px;
            z-index: 100;
        }

        .card {
            width: 60px;
            height: 84px;
            background: white;
            border: 1px solid #333;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .card:hover {
            transform: translateY(-10px);
        }

        .card.selected {
            transform: translateY(-15px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.5);
            border: 2px solid #ffd700;
        }

        .card-value {
            font-size: 14px;
            font-weight: bold;
            align-self: flex-start;
        }

        .card-suit {
            font-size: 26px;
            margin-top: auto;
            margin-bottom: auto;
        }

        .red {
            color: red;
        }

        .black {
            color: black;
        }

        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }

        button {
            padding: 10px 20px;
            background: #d4af37;
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: background 0.3s ease;
        }

        button:hover {
            background: #b8941f;
        }

        button:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .bid-controls {
            position: fixed;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            flex-direction: row;
            gap: 10px;
            align-items: center;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #d4af37;
        }

        .bid-amount {
            font-size: 20px;
            font-weight: bold;
            color: #ffd700;
            margin: 0 15px;
        }

        .trump-selection {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            flex-direction: column;
            gap: 15px;
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #d4af37;
            z-index: 200;
        }

        .suit-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .suit-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            cursor: pointer;
            background: white;
            border: 2px solid #333;
            transition: all 0.3s ease;
        }

        .suit-button:hover {
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .suit-button.selected {
            background: #d4af37;
            border-color: #b8941f;
            transform: scale(1.1);
        }

        .partner-selection {
            margin-top: 20px;
        }

        .partner-cards {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 400px;
        }

        .phase-indicator {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 20px;
            border: 2px solid #d4af37;
            font-weight: bold;
            font-size: 16px;
            z-index: 100;
        }

        .shuffle-animation {
            position: absolute;
            width: 40px;
            height: 56px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-radius: 4px;
            animation: shuffle 2s ease-in-out;
        }

        @keyframes shuffle {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 0.7; }
            100% { transform: scale(1) rotate(360deg); opacity: 1; }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ffd700;
            animation: confetti-fall 3s linear infinite;
            z-index: 1000;
        }

        .confetti:nth-child(odd) {
            background: #ff6b6b;
            animation-delay: -0.5s;
        }

        .confetti:nth-child(3n) {
            background: #4ecdc4;
            animation-delay: -1s;
        }

        .confetti:nth-child(4n) {
            background: #45b7d1;
            animation-delay: -1.5s;
        }

        .confetti:nth-child(5n) {
            background: #96ceb4;
            animation-delay: -2s;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .blowhorn {
            position: fixed;
            width: 60px;
            height: 40px;
            background: linear-gradient(45deg, #8b4513, #daa520);
            border-radius: 20px 5px 5px 20px;
            animation: blowhorn-blow 0.5s ease-in-out;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .blowhorn::before {
            content: '📯';
            animation: horn-shake 0.1s ease-in-out infinite;
        }

        .blowhorn-sound {
            position: fixed;
            font-size: 48px;
            font-weight: bold;
            color: #ff4444;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: sound-wave 0.8s ease-out;
            z-index: 1001;
            pointer-events: none;
        }

        @keyframes blowhorn-blow {
            0% { transform: scale(0) rotate(-45deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(0deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        @keyframes horn-shake {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }

        @keyframes sound-wave {
            0% { 
                transform: scale(0.5); 
                opacity: 1; 
            }
            50% { 
                transform: scale(1.2); 
                opacity: 0.8; 
            }
            100% { 
                transform: scale(2); 
                opacity: 0; 
            }
        }

        .played-card {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 56px;
            background: white;
            border: 1px solid #333;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="welcome-screen" id="welcomeScreen">
        <div class="game-title">Shadow Queen</div>
        <div class="game-subtitle">The Ultimate Card Game Experience</div>
        
        <div class="menu-options">
            <button class="menu-button" id="singlePlayerBtn">🎮 Single Player</button>
            <button class="menu-button" id="multiPlayerBtn" disabled style="opacity: 0.5;">👥 Multiplayer (Coming Soon)</button>
        </div>
        
        <div class="game-rules-preview">
            <p><strong>Shadow Queen</strong> is a trick-taking card game with bidding and hidden partnerships.</p>
            <p>🃏 Bid to become the main team leader<br>
            🎯 Choose trump suit and partner card<br>
            ⚔️ Battle against the village team<br>
            🏆 Score points to claim victory!</p>
        </div>
    </div>

    <div class="game-container">
        <div class="table" id="table">
            <div class="center-info" id="centerInfo">
                <div id="gameStatus">Ready to Play</div>
                <div class="leading-suit" id="leadingSuit" style="display: none;">
                    Leading: <span id="leadingSuitSymbol"></span>
                </div>
                <div class="trump-info" id="trumpInfo" style="display: none;">
                    Trump: <span id="trumpSuit"></span>
                </div>
                <div class="partner-info" id="partnerInfo" style="display: none;">
                    Partner: <span id="partnerCard"></span>
                </div>
            </div>
        </div>

        <div class="cards-container" id="playerCards"></div>

        <div class="controls">
            <button id="startGame">Start Game</button>
            <div>Round: <span id="roundCounter">0</span>/10</div>
            <div>Score - Main: <span id="mainScore">0</span> Village: <span id="villageScore">0</span></div>
        </div>

        <div class="phase-indicator" id="phaseIndicator">
            Initializing Game
        </div>

        <div class="bid-controls" id="bidControls">
            <button id="decreaseBid">-5</button>
            <div class="bid-amount" id="bidAmount">150</div>
            <button id="increaseBid">+5</button>
            <button id="submitBid">Bid</button>
            <button id="passBid">Pass</button>
        </div>

        <div class="trump-selection" id="trumpSelection">
            <h3>Select Trump Suit</h3>
            <div class="suit-buttons">
                <div class="suit-button" data-suit="spades" style="color: black;">♠</div>
                <div class="suit-button" data-suit="hearts" style="color: red;">♥</div>
                <div class="suit-button" data-suit="diamonds" style="color: red;">♦</div>
                <div class="suit-button" data-suit="clubs" style="color: black;">♣</div>
            </div>
            <div class="partner-selection">
                <h4>Select Partner Card</h4>
                <div class="partner-cards" id="partnerCards"></div>
            </div>
        </div>
    </div>

    <script>
        // Initialize game when page loads
        let game = null;

        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing game...');
            game = new ShadowQueenGame();
        });

        class ShadowQueenGame {
            constructor() {
                console.log('Game constructor called');
                this.players = [];
                this.currentPlayerIndex = 0;
                this.phase = 'welcome';
                this.deck = [];
                this.playerHands = [];
                this.bidWinner = null;
                this.currentBid = 150;
                this.playerBids = [];
                this.trumpSuit = null;
                this.partnerCard = null;
                this.mainTeam = [];
                this.villageTeam = [];
                this.currentTrick = [];
                this.trickWinner = null;
                this.round = 0;
                this.mainTeamScore = 0;
                this.villageTeamScore = 0;
                this.gameStarted = false;
                this.gameSetup = false;
                
                this.setupEventListeners();
                this.showWelcomeScreen();
            }

            setupEventListeners() {
                console.log('Setting up event listeners...');
                
                // Add small delay to ensure DOM is ready
                setTimeout(() => {
                    const singlePlayerBtn = document.getElementById('singlePlayerBtn');
                    const multiPlayerBtn = document.getElementById('multiPlayerBtn');
                    const startGameBtn = document.getElementById('startGame');
                    
                    if (singlePlayerBtn) {
                        singlePlayerBtn.addEventListener('click', () => {
                            console.log('Single player clicked!');
                            this.startSinglePlayer();
                        });
                    }
                    
                    if (multiPlayerBtn) {
                        multiPlayerBtn.addEventListener('click', () => {
                            alert('Multiplayer mode coming soon!');
                        });
                    }
                    
                    if (startGameBtn) {
                        startGameBtn.addEventListener('click', () => {
                            console.log('Start game clicked!');
                            if (!this.gameStarted && this.gameSetup) {
                                this.gameStarted = true;
                                this.phase = 'shuffle';
                                startGameBtn.textContent = 'Restart Game';
                                this.startShuffleAnimation();
                            } else if (this.gameStarted) {
                                location.reload();
                            }
                        });
                    }
                }, 100);
            }

            showWelcomeScreen() {
                console.log('Showing welcome screen...');
                const welcomeScreen = document.getElementById('welcomeScreen');
                if (welcomeScreen) {
                    welcomeScreen.style.display = 'flex';
                }
                document.getElementById('phaseIndicator').textContent = 'Welcome to Shadow Queen';
            }

            startSinglePlayer() {
                console.log('Starting single player...');
                const welcomeScreen = document.getElementById('welcomeScreen');
                if (welcomeScreen) {
                    welcomeScreen.style.display = 'none';
                }
                
                this.phase = 'setup';
                this.initGame();
            }

            initGame() {
                console.log('Initializing game...');
                this.createPlayers();
                this.createDeck();
                this.positionPlayers();
                this.gameSetup = true;
                document.getElementById('gameStatus').textContent = 'Ready to Start';
                document.getElementById('phaseIndicator').textContent = 'Click Start Game to Begin';
            }

            createPlayers() {
                const availableNames = ['Alice', 'Bob', 'Carol', 'Dave', 'Eve', 'Frank', 'Grace', 'Henry', 'Ivy', 'Jack', 'Kate', 'Liam'];
                const usedNames = ['You'];
                
                this.players = [
                    { name: 'You', isHuman: true, angle: 0 }
                ];
                
                for (let i = 1; i <= 4; i++) {
                    let selectedName;
                    do {
                        selectedName = availableNames[Math.floor(Math.random() * availableNames.length)];
                    } while (usedNames.includes(selectedName));
                    
                    usedNames.push(selectedName);
                    this.players.push({
                        name: selectedName,
                        isHuman: false,
                        angle: i * 72
                    });
                }
            }

            createDeck() {
                const suits = ['spades', 'hearts', 'clubs', 'diamonds'];
                const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
                
                this.deck = [];
                suits.forEach(suit => {
                    values.forEach(value => {
                        this.deck.push({ suit, value });
                    });
                });
                
                this.deck = this.deck.filter(card => 
                    !(card.value === '2' && (card.suit === 'clubs' || card.suit === 'diamonds'))
                );
            }

            positionPlayers() {
                const table = document.getElementById('table');
                const radius = 35;
                
                this.players.forEach((player, index) => {
                    const playerDiv = document.createElement('div');
                    playerDiv.className = 'player';
                    playerDiv.id = `player-${index}`;
                    
                    const angle = (player.angle * Math.PI) / 180;
                    const x = 50 + radius * Math.cos(angle - Math.PI / 2);
                    const y = 50 + radius * Math.sin(angle - Math.PI / 2);
                    
                    playerDiv.style.left = `${x}%`;
                    playerDiv.style.top = `${y}%`;
                    playerDiv.style.transform = `translate(-50%, -50%)`;
                    
                    playerDiv.innerHTML = `
                        <div class="player-name">${player.name}</div>
                        <div class="player-bid" id="bid-${index}">-</div>
                    `;
                    
                    table.appendChild(playerDiv);
                });
            }

            startShuffleAnimation() {
                document.getElementById('gameStatus').textContent = 'Shuffling Cards...';
                document.getElementById('phaseIndicator').textContent = 'Shuffling Deck';
                
                const table = document.getElementById('table');
                const numCards = 20;
                
                for (let i = 0; i < numCards; i++) {
                    setTimeout(() => {
                        const card = document.createElement('div');
                        card.className = 'shuffle-animation';
                        card.style.left = `${20 + Math.random() * 60}%`;
                        card.style.top = `${20 + Math.random() * 60}%`;
                        table.appendChild(card);
                        
                        setTimeout(() => {
                            if (card.parentNode) {
                                card.parentNode.removeChild(card);
                            }
                        }, 2000);
                    }, i * 100);
                }
                
                setTimeout(() => {
                    this.dealCards();
                    this.startBidding();
                }, 2500);
            }

            dealCards() {
                for (let i = this.deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.deck[i], this.deck[j]] = [this.deck[j], this.deck[i]];
                }
                
                this.playerHands = [[], [], [], [], []];
                for (let i = 0; i < 10; i++) {
                    for (let j = 0; j < 5; j++) {
                        this.playerHands[j].push(this.deck[i * 5 + j]);
                    }
                }
                
                this.sortPlayerCards();
                this.displayPlayerCards();
            }

            sortPlayerCards() {
                const suitColorOrder = [
                    { suit: 'spades', color: 'black' },
                    { suit: 'hearts', color: 'red' },
                    { suit: 'clubs', color: 'black' },
                    { suit: 'diamonds', color: 'red' }
                ];
                
                const valueOrder = ['A', 'K', 'Q', 'J', '10', '9', '8', '7', '6', '5', '4', '3', '2'];
                
                const presentSuits = [...new Set(this.playerHands[0].map(card => card.suit))];
                const availableSuits = suitColorOrder.filter(suitInfo => 
                    presentSuits.includes(suitInfo.suit)
                );
                
                const groupedCards = [];
                availableSuits.forEach(suitInfo => {
                    const suitCards = this.playerHands[0].filter(card => card.suit === suitInfo.suit);
                    if (suitCards.length > 0) {
                        suitCards.sort((a, b) => valueOrder.indexOf(a.value) - valueOrder.indexOf(b.value));
                        groupedCards.push(...suitCards);
                    }
                });
                
                this.playerHands[0] = groupedCards;
            }

            displayPlayerCards() {
                const container = document.getElementById('playerCards');
                container.innerHTML = '';
                
                this.playerHands[0].forEach((card, index) => {
                    const cardDiv = document.createElement('div');
                    cardDiv.className = 'card';
                    cardDiv.dataset.cardIndex = index;
                    
                    const isRed = card.suit === 'hearts' || card.suit === 'diamonds';
                    const suitSymbol = this.getSuitSymbol(card.suit);
                    
                    cardDiv.innerHTML = `
                        <div class="card-value ${isRed ? 'red' : 'black'}">${card.value}</div>
                        <div class="card-suit ${isRed ? 'red' : 'black'}">${suitSymbol}</div>
                    `;
                    
                    container.appendChild(cardDiv);
                });
            }

            getSuitSymbol(suit) {
                const symbols = {
                    spades: '♠',
                    hearts: '♥',
                    diamonds: '♦',
                    clubs: '♣'
                };
                return symbols[suit];
            }

            startBidding() {
                this.phase = 'bid';
                this.currentPlayerIndex = 1;
                this.playerBids = [null, null, null, null, null];
                this.currentBid = 150;
                
                document.getElementById('gameStatus').textContent = 'Bidding Phase';
                document.getElementById('phaseIndicator').textContent = 'Bidding in Progress';
                
                this.highlightCurrentPlayer();
                this.processBidding();
            }

            highlightCurrentPlayer() {
                this.players.forEach((_, index) => {
                    const playerDiv = document.getElementById(`player-${index}`);
                    if (playerDiv) playerDiv.classList.remove('active');
                });
                
                const playerDiv = document.getElementById(`player-${this.currentPlayerIndex}`);
                if (playerDiv) playerDiv.classList.add('active');
            }

            processBidding() {
                if (this.phase !== 'bid') return;
                
                const currentPlayer = this.players[this.currentPlayerIndex];
                
                if (currentPlayer.isHuman) {
                    this.showBidControls();
                } else {
                    this.aiMakeBid();
                }
            }

            showBidControls() {
                const bidControls = document.getElementById('bidControls');
                bidControls.style.display = 'flex';
                document.getElementById('bidAmount').textContent = this.currentBid + 5;
                
                document.getElementById('decreaseBid').onclick = () => {
                    const currentAmount = parseInt(document.getElementById('bidAmount').textContent);
                    const minimumBid = this.currentBid + 5;
                    if (currentAmount > minimumBid) {
                        document.getElementById('bidAmount').textContent = currentAmount - 5;
                    }
                };
                
                document.getElementById('increaseBid').onclick = () => {
                    const currentAmount = parseInt(document.getElementById('bidAmount').textContent);
                    if (currentAmount < 260) {
                        document.getElementById('bidAmount').textContent = currentAmount + 5;
                    }
                };
                
                document.getElementById('submitBid').onclick = () => {
                    const bidAmount = parseInt(document.getElementById('bidAmount').textContent);
                    this.makeBid(this.currentPlayerIndex, bidAmount);
                    bidControls.style.display = 'none';
                };
                
                document.getElementById('passBid').onclick = () => {
                    this.makeBid(this.currentPlayerIndex, 'pass');
                    bidControls.style.display = 'none';
                };
            }

            aiMakeBid() {
                setTimeout(() => {
                    const hand = this.playerHands[this.currentPlayerIndex];
                    const handStrength = this.evaluateHandStrength(hand);
                    
                    let bidAmount = 'pass';
                    
                    if (handStrength > 0.7 && this.currentBid < 200) {
                        bidAmount = this.currentBid + 5 + Math.floor(Math.random() * 3) * 5;
                    } else if (handStrength > 0.5 && this.currentBid < 180) {
                        bidAmount = this.currentBid + 5;
                    }
                    
                    if (bidAmount !== 'pass' && bidAmount > 260) {
                        bidAmount = 'pass';
                    }
                    
                    this.makeBid(this.currentPlayerIndex, bidAmount);
                }, 1000 + Math.random() * 1000);
            }

            evaluateHandStrength(hand) {
                let strength = 0;
                const suitCounts = { spades: 0, hearts: 0, diamonds: 0, clubs: 0 };
                
                hand.forEach(card => {
                    suitCounts[card.suit]++;
                    
                    if (card.value === 'A') strength += 0.15;
                    else if (card.value === 'K') strength += 0.1;
                    else if (card.value === 'Q' && card.suit === 'spades') strength += 0.2;
                    else if (card.value === 'Q') strength += 0.1;
                    else if (card.value === 'J') strength += 0.08;
                    else if (card.value === '10') strength += 0.05;
                    else if (card.value === '5') strength += 0.03;
                });
                
                Object.values(suitCounts).forEach(count => {
                    if (count >= 4) strength += 0.1;
                    if (count >= 5) strength += 0.1;
                });
                
                return Math.min(strength, 1);
            }

            makeBid(playerIndex, bidAmount) {
                this.playerBids[playerIndex] = bidAmount;
                
                const bidDisplay = document.getElementById(`bid-${playerIndex}`);
                bidDisplay.textContent = bidAmount === 'pass' ? 'Pass' : bidAmount;
                
                if (bidAmount !== 'pass' && bidAmount > this.currentBid) {
                    this.currentBid = bidAmount;
                    this.bidWinner = playerIndex;
                }
                
                this.nextBidder();
            }

            nextBidder() {
                let passedPlayers = this.playerBids.filter(bid => bid === 'pass').length;
                
                if (passedPlayers === 4 && this.bidWinner !== null) {
                    this.endBidding();
                    return;
                }
                
                do {
                    this.currentPlayerIndex = (this.currentPlayerIndex + 1) % 5;
                } while (this.playerBids[this.currentPlayerIndex] === 'pass');
                
                this.highlightCurrentPlayer();
                this.processBidding();
            }

            endBidding() {
                this.phase = 'trump';
                document.getElementById('gameStatus').textContent = `${this.players[this.bidWinner].name} won with ${this.currentBid}`;
                document.getElementById('phaseIndicator').textContent = 'Trump Selection';
                
                this.players.forEach((_, index) => {
                    const playerDiv = document.getElementById(`player-${index}`);
                    if (playerDiv) playerDiv.classList.remove('active');
                });
                
                if (this.players[this.bidWinner].isHuman) {
                    this.showTrumpSelection();
                } else {
                    this.aiSelectTrump();
                }
            }

            showTrumpSelection() {
                const trumpDiv = document.getElementById('trumpSelection');
                trumpDiv.style.display = 'flex';
                
                document.querySelectorAll('.suit-button').forEach(button => {
                    button.onclick = () => {
                        document.querySelectorAll('.suit-button').forEach(b => {
                            b.classList.remove('selected');
                        });
                        button.classList.add('selected');
                        this.selectedTrump = button.dataset.suit;
                    };
                });
                
                this.showAvailablePartnerCards();
            }

            showAvailablePartnerCards() {
                const container = document.getElementById('partnerCards');
                container.innerHTML = '';
                
                const playerCards = this.playerHands[this.bidWinner];
                const allPossibleCards = [];
                const suits = ['spades', 'hearts', 'clubs', 'diamonds'];
                const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
                
                suits.forEach(suit => {
                    values.forEach(value => {
                        if (!playerCards.some(card => card.suit === suit && card.value === value)) {
                            if (!(value === '2' && (suit === 'clubs' || suit === 'diamonds'))) {
                                allPossibleCards.push({ suit, value });
                            }
                        }
                    });
                });
                
                allPossibleCards.forEach(card => {
                    const cardDiv = document.createElement('div');
                    cardDiv.className = 'card';
                    cardDiv.style.width = '40px';
                    cardDiv.style.height = '56px';
                    cardDiv.style.fontSize = '8px';
                    
                    const isRed = card.suit === 'hearts' || card.suit === 'diamonds';
                    const suitSymbol = this.getSuitSymbol(card.suit);
                    
                    cardDiv.innerHTML = `
                        <div class="card-value ${isRed ? 'red' : 'black'}">${card.value}</div>
                        <div class="card-suit ${isRed ? 'red' : 'black'}">${suitSymbol}</div>
                    `;
                    
                    cardDiv.onclick = () => {
                        document.querySelectorAll('.partner-cards .card').forEach(c => c.classList.remove('selected'));
                        cardDiv.classList.add('selected');
                        this.selectedPartner = card;
                        
                        if (this.selectedTrump && this.selectedPartner) {
                            this.confirmTrumpSelection();
                        }
                    };
                    
                    container.appendChild(cardDiv);
                });
            }

            confirmTrumpSelection() {
                if (!this.selectedTrump || !this.selectedPartner) return;
                
                this.trumpSuit = this.selectedTrump;
                this.partnerCard = this.selectedPartner;
                
                this.mainTeam = [this.bidWinner];
                this.villageTeam = [];
                
                for (let i = 0; i < 5; i++) {
                    if (i !== this.bidWinner) {
                        this.villageTeam.push(i);
                    }
                }
                
                document.getElementById('trumpSuit').textContent = this.getSuitSymbol(this.trumpSuit);
                document.getElementById('partnerCard').textContent = `${this.partnerCard.value}${this.getSuitSymbol(this.partnerCard.suit)}`;
                document.getElementById('trumpInfo').style.display = 'block';
                document.getElementById('partnerInfo').style.display = 'block';
                document.getElementById('trumpSelection').style.display = 'none';
                
                this.startGamePlay();
            }

            aiSelectTrump() {
                setTimeout(() => {
                    const hand = this.playerHands[this.bidWinner];
                    const suitCounts = { spades: 0, hearts: 0, diamonds: 0, clubs: 0 };
                    
                    hand.forEach(card => {
                        suitCounts[card.suit]++;
                    });
                    
                    this.trumpSuit = Object.keys(suitCounts).reduce((a, b) => 
                        suitCounts[a] > suitCounts[b] ? a : b
                    );
                    
                    this.partnerCard = this.selectBestPartnerCard(hand);
                    
                    this.mainTeam = [this.bidWinner];
                    this.villageTeam = [];
                    
                    for (let i = 0; i < 5; i++) {
                        if (i !== this.bidWinner) {
                            this.villageTeam.push(i);
                        }
                    }
                    
                    document.getElementById('trumpSuit').textContent = this.getSuitSymbol(this.trumpSuit);
                    document.getElementById('partnerCard').textContent = `${this.partnerCard.value}${this.getSuitSymbol(this.partnerCard.suit)}`;
                    document.getElementById('trumpInfo').style.display = 'block';
                    document.getElementById('partnerInfo').style.display = 'block';
                    
                    this.startGamePlay();
                }, 2000);
            }

            selectBestPartnerCard(hand) {
                const suits = ['spades', 'hearts', 'clubs', 'diamonds'];
                const values = ['A', 'K', 'Q', 'J', '10', '9', '8', '7', '6', '5', '4', '3', '2'];
                
                for (const value of values) {
                    for (const suit of suits) {
                        if (!hand.some(card => card.suit === suit && card.value === value)) {
                            if (!(value === '2' && (suit === 'clubs' || suit === 'diamonds'))) {
                                return { suit, value };
                            }
                        }
                    }
                }
                
                return { suit: 'spades', value: 'A' };
            }

            startGamePlay() {
                this.phase = 'play';
                this.round = 1;
                this.currentPlayerIndex = this.bidWinner;
                this.currentTrick = [];
                this.mainTeamScore = 0;
                this.villageTeamScore = 0;
                
                document.getElementById('gameStatus').textContent = `Round ${this.round}/10`;
                document.getElementById('phaseIndicator').textContent = 'Playing Cards';
                document.getElementById('roundCounter').textContent = this.round;
                
                this.highlightCurrentPlayer();
                this.processCardPlay();
            }

            processCardPlay() {
                if (this.phase !== 'play') return;
                
                const currentPlayer = this.players[this.currentPlayerIndex];
                
                if (currentPlayer.isHuman) {
                    this.enableCardSelection();
                } else {
                    this.aiPlayCard();
                }
            }

            enableCardSelection() {
                const cards = document.querySelectorAll('#playerCards .card');
                cards.forEach((cardDiv, index) => {
                    cardDiv.onclick = () => {
                        const card = this.playerHands[0][index];
                        if (this.isValidCardPlay(card)) {
                            this.playCard(0, index);
                        } else {
                            alert('Invalid card play! You must follow suit if possible.');
                        }
                    };
                });
            }

            isValidCardPlay(card) {
                if (this.currentTrick.length === 0) return true;
                
                const leadSuit = this.currentTrick[0].card.suit;
                const playerHand = this.playerHands[0];
                
                if (card.suit === leadSuit) return true;
                
                const hasSuit = playerHand.some(c => c.suit === leadSuit);
                return !hasSuit;
            }

            aiPlayCard() {
                setTimeout(() => {
                    const hand = this.playerHands[this.currentPlayerIndex];
                    let cardIndex = 0;
                    
                    if (this.currentTrick.length === 0) {
                        cardIndex = this.findBestLeadCard(hand);
                    } else {
                        cardIndex = this.findBestFollowCard(hand);
                    }
                    
                    this.playCard(this.currentPlayerIndex, cardIndex);
                }, 1000 + Math.random() * 1000);
            }

            findBestLeadCard(hand) {
                const valueRanks = { 'A': 14, 'K': 13, 'Q': 12, 'J': 11, '10': 10, '9': 9, '8': 8, '7': 7, '6': 6, '5': 5, '4': 4, '3': 3, '2': 2 };
                
                let bestIndex = 0;
                let bestValue = 0;
                
                hand.forEach((card, index) => {
                    let value = valueRanks[card.value];
                    if (card.suit === this.trumpSuit) value += 20;
                    
                    if (value > bestValue) {
                        bestValue = value;
                        bestIndex = index;
                    }
                });
                
                return bestIndex;
            }

            findBestFollowCard(hand) {
                const leadSuit = this.currentTrick[0].card.suit;
                const suitCards = hand.map((card, index) => ({ card, index }))
                    .filter(item => item.card.suit === leadSuit);
                
                if (suitCards.length > 0) {
                    return this.findHighestCard(suitCards.map(item => item.card), hand);
                } else {
                    const trumpCards = hand.map((card, index) => ({ card, index }))
                        .filter(item => item.card.suit === this.trumpSuit);
                    
                    if (trumpCards.length > 0) {
                        return this.findHighestCard(trumpCards.map(item => item.card), hand);
                    } else {
                        return this.findLowestCard(hand);
                    }
                }
            }

            findHighestCard(cards, fullHand) {
                const valueRanks = { 'A': 14, 'K': 13, 'Q': 12, 'J': 11, '10': 10, '9': 9, '8': 8, '7': 7, '6': 6, '5': 5, '4': 4, '3': 3, '2': 2 };
                
                let bestCard = cards[0];
                let bestIndex = fullHand.indexOf(bestCard);
                
                cards.forEach(card => {
                    if (valueRanks[card.value] > valueRanks[bestCard.value]) {
                        bestCard = card;
                        bestIndex = fullHand.indexOf(card);
                    }
                });
                
                return bestIndex;
            }

            findLowestCard(hand) {
                const valueRanks = { 'A': 14, 'K': 13, 'Q': 12, 'J': 11, '10': 10, '9': 9, '8': 8, '7': 7, '6': 6, '5': 5, '4': 4, '3': 3, '2': 2 };
                
                let lowestIndex = 0;
                let lowestValue = 15;
                
                hand.forEach((card, index) => {
                    if (valueRanks[card.value] < lowestValue) {
                        lowestValue = valueRanks[card.value];
                        lowestIndex = index;
                    }
                });
                
                return lowestIndex;
            }

            playCard(playerIndex, cardIndex) {
                const card = this.playerHands[playerIndex][cardIndex];
                
                if (card.suit === this.partnerCard.suit && card.value === this.partnerCard.value) {
                    if (!this.mainTeam.includes(playerIndex)) {
                        this.mainTeam.push(playerIndex);
                        this.villageTeam = this.villageTeam.filter(p => p !== playerIndex);
                        
                        const playerDiv = document.getElementById(`player-${playerIndex}`);
                        if (playerDiv) playerDiv.classList.add('main-team');
                    }
                }
                
                this.currentTrick.push({ player: playerIndex, card });
                
                if (this.currentTrick.length === 1) {
                    const leadingSuitElement = document.getElementById('leadingSuit');
                    const leadingSuitSymbol = document.getElementById('leadingSuitSymbol');
                    leadingSuitElement.style.display = 'block';
                    leadingSuitSymbol.textContent = this.getSuitSymbol(card.suit);
                    leadingSuitSymbol.className = (card.suit === 'hearts' || card.suit === 'diamonds') ? 'red' : 'black';
                }
                
                this.playerHands[playerIndex].splice(cardIndex, 1);
                
                this.displayPlayedCard(playerIndex, card);
                
                if (playerIndex === 0) {
                    this.displayPlayerCards();
                }
                
                if (this.currentTrick.length === 5) {
                    this.evaluateTrick();
                } else {
                    this.nextPlayer();
                }
            }

            displayPlayedCard(playerIndex, card) {
                const playerDiv = document.getElementById(`player-${playerIndex}`);
                const existingCard = playerDiv.querySelector('.played-card');
                if (existingCard) {
                    existingCard.remove();
                }
                
                const cardDiv = document.createElement('div');
                cardDiv.className = 'played-card';
                
                const isRed = card.suit === 'hearts' || card.suit === 'diamonds';
                const suitSymbol = this.getSuitSymbol(card.suit);
                
                cardDiv.innerHTML = `
                    <div class="${isRed ? 'red' : 'black'}">${card.value}</div>
                    <div class="${isRed ? 'red' : 'black'}">${suitSymbol}</div>
                `;
                
                playerDiv.appendChild(cardDiv);
            }

            nextPlayer() {
                this.currentPlayerIndex = (this.currentPlayerIndex + 1) % 5;
                this.highlightCurrentPlayer();
                this.processCardPlay();
            }

            evaluateTrick() {
                const leadSuit = this.currentTrick[0].card.suit;
                let winningPlay = this.currentTrick[0];
                
                const valueRanks = { 'A': 14, 'K': 13, 'Q': 12, 'J': 11, '10': 10, '9': 9, '8': 8, '7': 7, '6': 6, '5': 5, '4': 4, '3': 3, '2': 2 };
                
                this.currentTrick.forEach(play => {
                    const isTrump = play.card.suit === this.trumpSuit;
                    const isLeadSuit = play.card.suit === leadSuit;
                    const winnerIsTrump = winningPlay.card.suit === this.trumpSuit;
                    const winnerIsLeadSuit = winningPlay.card.suit === leadSuit;
                    
                    if (isTrump && !winnerIsTrump) {
                        winningPlay = play;
                    } else if (isTrump && winnerIsTrump && valueRanks[play.card.value] > valueRanks[winningPlay.card.value]) {
                        winningPlay = play;
                    } else if (!isTrump && !winnerIsTrump && isLeadSuit && winnerIsLeadSuit && 
                              valueRanks[play.card.value] > valueRanks[winningPlay.card.value]) {
                        winningPlay = play;
                    } else if (!isTrump && !winnerIsTrump && isLeadSuit && !winnerIsLeadSuit) {
                        winningPlay = play;
                    }
                });
                
                this.trickWinner = winningPlay.player;
                this.awardTrickPoints();
                
                setTimeout(() => {
                    this.clearPlayedCards();
                    this.nextRound();
                }, 2000);
            }

            awardTrickPoints() {
                let trickPoints = 0;
                
                this.currentTrick.forEach(play => {
                    const card = play.card;
                    if (card.value === '5') trickPoints += 5;
                    else if (card.value === '10') trickPoints += 10;
                    else if (card.value === 'A') trickPoints += 15;
                    else if (card.value === 'J' || card.value === 'K') trickPoints += 10;
                    else if (card.value === 'Q' && card.suit === 'spades') trickPoints += 30;
                    else if (card.value === 'Q') trickPoints += 10;
                });
                
                if (this.mainTeam.includes(this.trickWinner)) {
                    this.mainTeamScore += trickPoints;
                } else {
                    this.villageTeamScore += trickPoints;
                }
                
                document.getElementById('mainScore').textContent = this.mainTeamScore;
                document.getElementById('villageScore').textContent = this.villageTeamScore;
            }

            clearPlayedCards() {
                this.players.forEach((_, index) => {
                    const playerDiv = document.getElementById(`player-${index}`);
                    const playedCard = playerDiv.querySelector('.played-card');
                    if (playedCard) {
                        playedCard.remove();
                    }
                });
                
                document.getElementById('leadingSuit').style.display = 'none';
            }

            nextRound() {
                this.currentTrick = [];
                this.round++;
                
                if (this.round > 10) {
                    this.endGame();
                    return;
                }
                
                document.getElementById('roundCounter').textContent = this.round;
                document.getElementById('gameStatus').textContent = `Round ${this.round}/10`;
                
                this.currentPlayerIndex = this.trickWinner;
                this.highlightCurrentPlayer();
                this.processCardPlay();
            }

            endGame() {
                this.phase = 'end';
                const targetScore = 260 - this.currentBid;
                const villageWins = this.villageTeamScore > targetScore;
                const humanInMainTeam = this.mainTeam.includes(0);
                const humanTeamWins = (humanInMainTeam && !villageWins) || (!humanInMainTeam && villageWins);
                
                document.getElementById('phaseIndicator').textContent = 'Game Over';
                document.getElementById('gameStatus').innerHTML = `
                    <div>Game Over!</div>
                    <div>Village needed: ${targetScore + 1}+ points</div>
                    <div>Village got: ${this.villageTeamScore} points</div>
                    <div><strong>${villageWins ? 'Village Team Wins!' : 'Main Team Wins!'}</strong></div>
                    ${humanTeamWins ? '<div style="color: #ffd700; margin-top: 10px;">🎉 YOU WON! 🎉</div>' : '<div style="color: #ff4444; margin-top: 10px;">💥 YOU LOST! 💥</div>'}
                `;
                
                if (humanTeamWins) {
                    this.showConfetti();
                } else {
                    this.showBlowhorns();
                }
                
                this.mainTeam.forEach(playerIndex => {
                    const playerDiv = document.getElementById(`player-${playerIndex}`);
                    if (playerDiv) playerDiv.classList.add('main-team');
                });
                
                this.villageTeam.forEach(playerIndex => {
                    const playerDiv = document.getElementById(`player-${playerIndex}`);
                    if (playerDiv) playerDiv.classList.add('village-team');
                });
                
                this.players.forEach((_, index) => {
                    const playerDiv = document.getElementById(`player-${index}`);
                    if (playerDiv) playerDiv.classList.remove('active');
                });
            }

            showConfetti() {
                const colors = ['#ffd700', '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4'];
                const confettiCount = 50;
                
                for (let i = 0; i < confettiCount; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + 'vw';
                        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.animationDelay = Math.random() * 3 + 's';
                        document.body.appendChild(confetti);
                        
                        setTimeout(() => {
                            if (confetti.parentNode) {
                                confetti.parentNode.removeChild(confetti);
                            }
                        }, 3000);
                    }, i * 100);
                }
            }

            showBlowhorns() {
                const hornCount = 8;
                const soundEffects = ['HONK!', 'BEEP!', 'BLARE!', 'TOOT!', 'WAAAAH!'];
                
                for (let i = 0; i < hornCount; i++) {
                    setTimeout(() => {
                        const blowhorn = document.createElement('div');
                        blowhorn.className = 'blowhorn';
                        blowhorn.style.left = (Math.random() * 80 + 10) + 'vw';
                        blowhorn.style.top = (Math.random() * 60 + 20) + 'vh';
                        document.body.appendChild(blowhorn);
                        
                        const soundText = document.createElement('div');
                        soundText.className = 'blowhorn-sound';
                        soundText.textContent = soundEffects[Math.floor(Math.random() * soundEffects.length)];
                        soundText.style.left = blowhorn.style.left;
                        soundText.style.top = (parseInt(blowhorn.style.top) - 10) + 'vh';
                        document.body.appendChild(soundText);
                        
                        setTimeout(() => {
                            if (blowhorn.parentNode) blowhorn.parentNode.removeChild(blowhorn);
                        }, 2000);
                        
                        setTimeout(() => {
                            if (soundText.parentNode) soundText.parentNode.removeChild(soundText);
                        }, 800);
                        
                    }, i * 200);
                }
                
                this.flashScreen();
            }

            flashScreen() {
                const flash = document.createElement('div');
                flash.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: rgba(255, 68, 68, 0.3);
                    z-index: 999;
                    pointer-events: none;
                    animation: flash 0.3s ease-out;
                `;
                
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes flash {
                        0% { opacity: 0; }
                        50% { opacity: 1; }
                        100% { opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
                document.body.appendChild(flash);
                
                setTimeout(() => {
                    if (flash.parentNode) flash.parentNode.removeChild(flash);
                    if (style.parentNode) style.parentNode.removeChild(style);
                }, 300);
            }
        }
    </script>
</body>
</html>